---
name: Wrapper for jfrog/setup-jfrog-cli
author: Malena Ebert
description: Setup authenticated JF cli
branding:
  color: green
  icon: lock
inputs:
  jfrogUrl:
    description: url of the artifactory instance
    default: https://repox.jfrog.io/
    required: false
  jfrogAccessToken:
    description: access token for authentication
    required: false
  jfrogCliVersion:
    description: version of the jfrog cli tool
    default: latest
    required: false
  vaultUrl:
    description: url of vault, if fetching a token is required
    default: https://vault.sonar.build:8200
    required: false
  artifactoryRoleSuffix:
    description: artifactory reader suffix specified in vault repo config
    default: private-reader
    required: false
runs:
  using: composite
  steps:
    - name: Fetch access token
      id: secrets
      if: ${{ !(inputs.jfrogAccessToken) }}
      uses: SonarSource/vault-action-wrapper@f4794f0a6d33f37c1900a4d8975a65cd53300dba # 2.8.0-1
      with:
        url: ${{ inputs.vaultUrl }}
        secrets: |
          development/artifactory/token/{REPO_OWNER_NAME_DASH}-${{ inputs.artifactoryRoleSuffix }} access_token | artifactory_access_token;
    - name: Setup JFrog CLI
      uses: jfrog/setup-jfrog-cli@25a4f3acc8d03eff03b885f41105505cb14b1d28 # v3.3.0
      with:
        version: ${{ inputs.jfrogCliVersion }}
      env:
        JF_URL: ${{ inputs.jfrogUrl }}
        JF_ACCESS_TOKEN: ${{ inputs.jfrogAccessToken || fromJSON(steps.secrets.outputs.vault).artifactory_access_token }}
